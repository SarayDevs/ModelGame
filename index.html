<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Piedra, Papel o Tijeras - IA</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Navegaci√≥n -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <span class="logo-icon">‚úä‚úã‚úåÔ∏è</span>
                <span class="logo-text">Piedra, Papel, Tijeras</span>
            </div>
            <ul class="nav-menu">
                <li><a href="#home" class="nav-link active">Inicio</a></li>
                <li><a href="#como-jugar" class="nav-link">C√≥mo Jugar</a></li>
                <li><a href="#jugar-sistema" class="nav-link">Jugar con Sistema</a></li>
                <li><a href="#jugar-online" class="nav-link">Jugar en L√≠nea</a></li>
            </ul>
            <div class="hamburger">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
    </nav>

    <!-- Secci√≥n Home -->
    <section id="home" class="section active">
        <div class="container">
            <div class="hero">
                <h1 class="hero-title">üéÆ Piedra, Papel o Tijeras</h1>
                <p class="hero-subtitle">Controlado por Inteligencia Artificial</p>
                <p class="hero-description">
                    Un juego cl√°sico reinventado con visi√≥n artificial y voz sint√©tica. 
                    Juega usando gestos de tu mano y escucha los resultados con una voz natural.
                </p>
            </div>

            <div class="info-grid">
                <div class="info-card">
                    <div class="info-icon">ü§ñ</div>
                    <h3>Teachable Machine</h3>
                    <p>
                        El modelo de visi√≥n artificial fue entrenado con cientos de fotograf√≠as 
                        de los gestos de piedra, papel y tijeras. Usa TensorFlow.js para detectar 
                        en tiempo real tu elecci√≥n mediante la c√°mara web.
                    </p>
                </div>
                <div class="info-card">
                    <div class="info-icon">üéôÔ∏è</div>
                    <h3>VAPI & ElevenLabs</h3>
                    <p>
                        La voz del juego utiliza VAPI integrado con ElevenLabs para generar 
                        respuestas naturales. El sistema fue alimentado con un archivo de prompts 
                        y reglas detalladas que describen el juego, sus estados y personalidad.
                    </p>
                </div>
                <div class="info-card">
                    <div class="info-icon">üî•</div>
                    <h3>Firebase Realtime</h3>
                    <p>
                        Para el modo multijugador en l√≠nea, utilizamos Firebase Realtime Database 
                        para sincronizar el estado del juego entre jugadores en tiempo real, 
                        permitiendo partidas fluidas y sin retrasos.
                    </p>
                </div>
            </div>

            <div class="cta-buttons">
                <a href="#jugar-sistema" class="btn btn-primary">Jugar con Sistema</a>
                <a href="#jugar-online" class="btn btn-secondary">Jugar en L√≠nea</a>
            </div>
        </div>
    </section>

    <!-- Secci√≥n C√≥mo Jugar -->
    <section id="como-jugar" class="section">
        <div class="container">
            <h2 class="section-title">üìñ C√≥mo Jugar</h2>
            
            <div class="rules-container">
                <div class="rule-card">
                    <div class="rule-number">1</div>
                    <h3>Inicializa la C√°mara</h3>
                    <p>Haz clic en "Inicializar C√°mara" y permite el acceso a tu c√°mara web cuando el navegador lo solicite.</p>
                </div>
                <div class="rule-card">
                    <div class="rule-number">2</div>
                    <h3>Elige tu Modo</h3>
                    <p>Puedes jugar contra el sistema (IA aleatoria) o contra otro jugador en l√≠nea.</p>
                </div>
                <div class="rule-card">
                    <div class="rule-number">3</div>
                    <h3>Realiza tu Gesto</h3>
                    <p>Cuando inicies el juego, muestra tu gesto a la c√°mara:</p>
                    <ul class="gesture-list">
                        <li><span class="gesture-emoji">‚úä</span> Piedra: Pu√±o cerrado</li>
                        <li><span class="gesture-emoji">‚úã</span> Papel: Mano abierta</li>
                        <li><span class="gesture-emoji">‚úåÔ∏è</span> Tijeras: Dos dedos extendidos</li>
                    </ul>
                </div>
                <div class="rule-card">
                    <div class="rule-number">4</div>
                    <h3>Reglas del Juego</h3>
                    <ul class="rules-list">
                        <li>‚úä <strong>Piedra</strong> vence a ‚úåÔ∏è <strong>Tijeras</strong></li>
                        <li>‚úã <strong>Papel</strong> vence a ‚úä <strong>Piedra</strong></li>
                        <li>‚úåÔ∏è <strong>Tijeras</strong> vence a ‚úã <strong>Papel</strong></li>
                        <li>Si ambos eligen lo mismo, es un <strong>Empate</strong></li>
                    </ul>
                </div>
                <div class="rule-card">
                    <div class="rule-number">5</div>
                    <h3>Escucha los Resultados</h3>
                    <p>El sistema anunciar√° con voz natural qui√©n gan√≥ cada ronda, los puntajes y el n√∫mero de rondas jugadas.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Secci√≥n Jugar con Sistema -->
    <section id="jugar-sistema" class="section">
        <div class="container">
            <h2 class="section-title">ü§ñ Jugar con Sistema</h2>
            <p class="section-description">Juega contra una inteligencia artificial que elige aleatoriamente entre piedra, papel o tijeras.</p>

            <div class="game-container">
                <div class="controls">
                    <button id="initCameraBtn" class="btn btn-primary">Inicializar C√°mara</button>
                    <button id="startBtn" class="btn btn-primary" disabled>Iniciar Juego</button>
                    <button id="resetBtn" class="btn btn-secondary">Reiniciar Marcador</button>
                </div>

                <div class="game-area">
                    <!-- Jugador 1 (Izquierda) -->
                    <div class="player-section" id="player1Section">
                        <h2>Jugador 1</h2>
                        <div id="webcam-container-1" class="webcam-container"></div>
                        <div id="label-container-1" class="label-container"></div>
                        <div class="gesture-display" id="gesture1">
                            <span class="emoji">üë§</span>
                            <p class="gesture-text">Esperando...</p>
                        </div>
                    </div>

                    <!-- Contador y Resultado -->
                    <div class="center-section">
                        <div id="countdown" class="countdown hidden">3</div>
                        <div id="result-display" class="result-display hidden">
                            <h3 id="result-text"></h3>
                            <div class="scoreboard">
                                <div class="score-item">
                                    <span>Jugador 1</span>
                                    <span id="score-player1">0</span>
                                </div>
                                <div class="score-item">
                                    <span id="opponent-label">Sistema</span>
                                    <span id="score-opponent">0</span>
                                </div>
                                <div class="score-item">
                                    <span>Rondas</span>
                                    <span id="rounds-count">0</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Sistema o Jugador 2 (Derecha) -->
                    <div class="player-section" id="player2Section">
                        <h2 id="opponent-title">Sistema</h2>
                        <div id="webcam-container-2" class="webcam-container hidden"></div>
                        <div id="label-container-2" class="label-container hidden"></div>
                        <div class="gesture-display" id="gesture2">
                            <span class="emoji" id="system-emoji">ü§ñ</span>
                            <p class="gesture-text" id="system-text">Esperando...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Secci√≥n Jugar en L√≠nea -->
    <section id="jugar-online" class="section">
        <div class="container">
            <h2 class="section-title">üåê Jugar en L√≠nea</h2>
            <p class="section-description">Con√©ctate con otro jugador y juega en tiempo real usando c√≥digos de sala.</p>

            <div class="online-info">
                <div class="info-box">
                    <h3>üéØ C√≥mo Funciona</h3>
                    <ol>
                        <li>Un jugador crea una sala y obtiene un c√≥digo √∫nico</li>
                        <li>El otro jugador ingresa ese c√≥digo para unirse</li>
                        <li>Ambos jugadores inicializan sus c√°maras</li>
                        <li>El creador de la sala inicia el juego</li>
                        <li>¬°Disfruta de una partida en tiempo real!</li>
                    </ol>
                </div>
            </div>

            <div class="game-container">
                <div class="controls">
                    <button id="initCameraBtn" class="btn btn-primary">Inicializar C√°mara</button>
                    <button id="startBtn" class="btn btn-primary" disabled>Iniciar Juego</button>
                    <button id="resetBtn" class="btn btn-secondary">Reiniciar Marcador</button>
                    <button id="salaBtn" class="btn btn-secondary">Sala</button>
                    <button id="leaveOnlineBtn" class="btn btn-secondary" style="display: none;">Salir del Modo Online</button>
                </div>

                <div class="game-area">
                    <!-- Jugador 1 (Izquierda) -->
                    <div class="player-section" id="player1Section">
                        <h2>Jugador 1</h2>
                        <div id="webcam-container-1" class="webcam-container"></div>
                        <div id="label-container-1" class="label-container"></div>
                        <div class="gesture-display" id="gesture1">
                            <span class="emoji">üë§</span>
                            <p class="gesture-text">Esperando...</p>
                        </div>
                    </div>

                    <!-- Contador y Resultado -->
                    <div class="center-section">
                        <div id="countdown" class="countdown hidden">3</div>
                        <div id="result-display" class="result-display hidden">
                            <h3 id="result-text"></h3>
                            <div class="scoreboard">
                                <div class="score-item">
                                    <span>Jugador 1</span>
                                    <span id="score-player1">0</span>
                                </div>
                                <div class="score-item">
                                    <span id="opponent-label">Oponente</span>
                                    <span id="score-opponent">0</span>
                                </div>
                                <div class="score-item">
                                    <span>Rondas</span>
                                    <span id="rounds-count">0</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Oponente (Derecha) -->
                    <div class="player-section" id="player2Section">
                        <h2 id="opponent-title">Oponente Online</h2>
                        <div id="webcam-container-2" class="webcam-container hidden"></div>
                        <div id="label-container-2" class="label-container hidden"></div>
                        <div class="gesture-display" id="gesture2">
                            <span class="emoji" id="system-emoji">üë§</span>
                            <p class="gesture-text" id="system-text">Esperando...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Modal para Juego Online -->
    <div id="onlineModal" class="modal hidden">
        <div class="modal-content">
            <button id="closeOnlineModalBtn" class="btn-close">√ó</button>
            <h2>üéÆ Juego Online</h2>
            <div id="onlineMenu">
                <button id="createRoomBtn" class="btn btn-primary">Crear Sala</button>
                <button id="joinRoomBtn" class="btn btn-secondary">Unirse a Sala</button>
            </div>
            <div id="roomCodeSection" class="hidden">
                <button id="closeRoomModalBtn" class="btn-close">√ó</button>
                <h3 id="roomCodeTitle"></h3>
                <div id="roomCodeDisplay" class="room-code-display"></div>
                <button id="copyCodeBtn" class="btn btn-primary" style="display: none;">üìã Copiar C√≥digo</button>
                <p id="roomStatus"></p>
                <div id="roomPlayers"></div>
                <input type="text" id="roomCodeInput" placeholder="Ingresa el c√≥digo de la sala (6 caracteres)" maxlength="6">
                <div class="modal-buttons">
                    <button id="startGameOnlineBtn" class="btn btn-primary" style="display: none;">üéÆ Iniciar Juego</button>
                    <button id="joinWithCodeBtn" class="btn btn-primary">Unirse</button>
                    <button id="cancelOnlineBtn" class="btn btn-secondary">Cancelar / Salir</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Resultado -->
    <div id="resultModal" class="modal hidden">
        <div class="modal-content">
            <h2 id="modal-title">Resultado</h2>
            <p id="modal-message"></p>
            <div class="modal-scores">
                <div class="modal-score-item">
                    <span>Jugador 1:</span>
                    <span id="modal-score-1">0</span>
                </div>
                <div class="modal-score-item">
                    <span id="modal-opponent-label">Sistema:</span>
                    <span id="modal-score-2">0</span>
                </div>
                <div class="modal-score-item">
                    <span>Rondas:</span>
                    <span id="modal-rounds">0</span>
                </div>
            </div>
            <button id="closeModal" class="btn btn-primary">Continuar</button>
        </div>
    </div>

    <!-- Widget de VAPI -->
    <vapi-widget
        public-key="d18dd720-b478-4f1a-8cd4-c2c1b8279b37"
        assistant-id="a93c4dbc-b279-4960-8901-14ef841ea4f6"
        mode="voice"
        theme="dark"
        base-bg-color="#000000"
        accent-color="#14B8A6"
        cta-button-color="#000000"
        cta-button-text-color="#ffffff"
        border-radius="large"
        size="full"
        position="bottom-right"
        title="TALK WITH AI"
        start-button-text="Start"
        end-button-text="End Call"
        chat-first-message="Hey, How can I help you today?"
        chat-placeholder="Type your message..."
        voice-show-transcript="true"
        consent-required="true"
        consent-title="Terms and conditions"
        consent-content="By clicking &quot;Agree,&quot; and each time I interact with this AI agent, I consent to the recording, storage, and sharing of my communications with third-party service providers, and as otherwise described in our Terms of Service."
        consent-storage-key="vapi_widget_consent">
    </vapi-widget>
    <script src="https://unpkg.com/@vapi-ai/client-sdk-react/dist/embed/widget.umd.js" async type="text/javascript"></script>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    
    <!-- Configuraci√≥n de Firebase -->
    <script src="firebase-config.js"></script>

    <!-- Scripts de TensorFlow y Teachable Machine -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js" 
            onload="console.log('TensorFlow.js cargado')" 
            onerror="console.error('Error al cargar TensorFlow.js')"></script>
    <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"
            onload="console.log('Teachable Machine Image cargado')" 
            onerror="console.error('Error al cargar Teachable Machine Image')"></script>
    
    <!-- Script principal -->
    <script>
        // Funci√≥n para esperar a que las librer√≠as se carguen
        function waitForLibraries(callback, maxAttempts = 50) {
            let attempts = 0;
            const checkInterval = setInterval(function() {
                attempts++;
                const tfLoaded = typeof tf !== 'undefined';
                const tmLoaded = typeof tmImage !== 'undefined' || 
                                typeof tm !== 'undefined' || 
                                (window.tmImage !== undefined) ||
                                (window.tm !== undefined);
                
                if (tfLoaded && tmLoaded) {
                    clearInterval(checkInterval);
                    console.log('‚úì Todas las librer√≠as cargadas correctamente');
                    if (typeof tmImage !== 'undefined') {
                        window.tmImage = tmImage;
                    } else if (typeof tm !== 'undefined') {
                        window.tmImage = tm;
                    }
                    callback();
                } else if (attempts >= maxAttempts) {
                    clearInterval(checkInterval);
                    console.error('Timeout esperando librer√≠as');
                    alert('Error: Las librer√≠as no se cargaron completamente.\n\nPor favor:\n1. Verifica tu conexi√≥n a internet\n2. Recarga la p√°gina (F5)');
                } else {
                    if (attempts % 10 === 0) {
                        console.log('Esperando librer√≠as... Intento ' + attempts + '/' + maxAttempts);
                    }
                }
            }, 200);
        }
        
        // Navegaci√≥n entre secciones
        document.addEventListener('DOMContentLoaded', function() {
            // Navegaci√≥n suave
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const targetId = this.getAttribute('href').substring(1);
                    showSection(targetId);
                    
                    // Actualizar navegaci√≥n activa
                    document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Cerrar men√∫ m√≥vil
                    document.querySelector('.nav-menu').classList.remove('active');
                });
            });

            // Men√∫ hamburguesa
            document.querySelector('.hamburger').addEventListener('click', function() {
                document.querySelector('.nav-menu').classList.toggle('active');
            });

            // Mostrar secci√≥n inicial
            showSection('home');
        });

        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            const targetSection = document.getElementById(sectionId);
            if (targetSection) {
                targetSection.classList.add('active');
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }
        
        // Esperar a que la p√°gina y los scripts se carguen
        window.addEventListener('load', function() {
            console.log('P√°gina cargada, esperando librer√≠as...');
            waitForLibraries(function() {
                loadMainScript();
            });
        });
        
        function loadMainScript() {
            const script = document.createElement('script');
            script.src = 'script.js';
            script.async = false;
            script.onload = function() {
                console.log('‚úì Script principal cargado');
            };
            script.onerror = function() {
                alert('Error al cargar script.js. Verifica que el archivo exista.');
            };
            document.body.appendChild(script);
        }
    </script>
</body>
</html>
